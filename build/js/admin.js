document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("test_github_connection");e&&e.addEventListener("click",function(e){e.preventDefault();const t=document.getElementById("connection_status");this.disabled=!0,t.innerHTML='<span class="testing">'+nanato_github_updates.testing_connection+"</span>";const n=new FormData;n.append("action","nanato_github_test_connection"),n.append("nonce",nanato_github_updates.nonce),n.append("token",document.getElementById("github_token").value),n.append("save",!1),fetch(nanato_github_updates.ajax_url,{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?t.innerHTML='<span class="success">'+e.data+"</span>":t.innerHTML='<span class="error">'+nanato_github_updates.connection_error+e.data+"</span>"}).catch(e=>{console.error("Fetch Error:",e),t.innerHTML='<span class="error">'+nanato_github_updates.connection_error+"Server error occurred. Check your server logs.</span>"}).finally(()=>{this.disabled=!1})});const t=document.getElementById("check-github-connection");t&&t.addEventListener("click",function(e){e.preventDefault();const t=document.getElementById("github-connection-status");this.disabled=!0,t.innerHTML='<span class="testing">'+nanato_github_updates.testing_connection+"</span>";const n=new FormData;n.append("action","nanato_github_test_connection"),n.append("nonce",nanato_github_updates.nonce),n.append("save",!1),fetch(nanato_github_updates.ajax_url,{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?t.innerHTML='<span class="success">'+e.data+"</span>":t.innerHTML='<span class="error">'+nanato_github_updates.connection_error+e.data+"</span>"}).catch(e=>{console.error("Fetch Error:",e),t.innerHTML='<span class="error">'+nanato_github_updates.connection_error+"Server error occurred. Check your server logs and browser console for details.</span>"}).finally(()=>{this.disabled=!1})});const n=document.getElementById("repo_type");n&&n.addEventListener("change",function(){const e=this.value,t=document.querySelectorAll(".theme-fields"),n=document.querySelectorAll(".plugin-fields");t.forEach(e=>e.style.display="none"),n.forEach(e=>e.style.display="none"),"theme"===e?t.forEach(e=>e.style.display="block"):"plugin"===e&&n.forEach(e=>e.style.display="block")});const a=document.getElementById("nanato-github-add-repo-form");a&&a.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("repo_type").value,n=document.getElementById("repo_owner").value,a=document.getElementById("repo_name").value,o=document.getElementById("theme_slug").value,r=document.getElementById("plugin_file").value;if(!t||!n||!a)return void alert("Please fill all required fields.");if("theme"===t&&!o)return void alert("Theme slug is required.");if("plugin"===t&&!r)return void alert("Plugin file is required.");const s=new FormData;s.append("action","nanato_github_add_repository"),s.append("nonce",nanato_github_updates.nonce),s.append("type",t),s.append("owner",n),s.append("name",a),s.append("slug",o),s.append("file",r);const d=document.getElementById("repo_auto_update")?.checked?"true":"false";s.append("auto_update",d),fetch(nanato_github_updates.ajax_url,{method:"POST",body:s}).then(e=>e.json()).then(e=>{e.success?location.reload():alert("Error: "+e.data)}).catch(e=>{console.error("Fetch Error:",e),alert("Server error occurred. Check your server logs.")})}),document.addEventListener("click",function(e){if(e.target&&e.target.classList.contains("remove-repo")){if(!confirm(nanato_github_updates.confirm_remove))return;const t=e.target.dataset.index,n=new FormData;n.append("action","nanato_github_remove_repository"),n.append("nonce",nanato_github_updates.nonce),n.append("index",t),fetch(nanato_github_updates.ajax_url,{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?location.reload():alert("Error: "+e.data)}).catch(e=>{console.error("Fetch Error:",e),alert("Server error occurred. Check your server logs.")})}}),document.addEventListener("click",function(e){if(e.target&&e.target.classList.contains("toggle-auto-update")){const t=e.target,n=t.dataset.index,a="1"===t.dataset.enabled,o=(!a).toString();t.disabled=!0,t.textContent=a?"Enabling...":"Disabling...";const r=new FormData;r.append("action","nanato_github_toggle_auto_update"),r.append("nonce",nanato_github_updates.nonce),r.append("index",n),r.append("enabled",o),fetch(nanato_github_updates.ajax_url,{method:"POST",body:r}).then(e=>e.json()).then(e=>{e.success?(t.dataset.enabled="true"===o?"1":"0",t.textContent="true"===o?"Disable":"Enable"):alert("Error: "+e.data)}).catch(e=>{console.error("Fetch Error:",e),alert("Server error occurred. Check your server logs.")}).finally(()=>{t.disabled=!1})}});const o=document.getElementById("nanato-github-search-form");o&&o.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("repo_owner").value,n=document.getElementById("repo_name").value;if(!t||!n)return void alert("Please enter both owner and repository name.");const a=this.querySelector('button[type="submit"]'),o=a.textContent;a.disabled=!0,a.textContent=nanato_github_updates.searching;const r=new FormData;r.append("action","nanato_github_search_repository"),r.append("nonce",nanato_github_updates.nonce),r.append("owner",t),r.append("name",n),fetch(nanato_github_updates.ajax_url,{method:"POST",body:r}).then(e=>e.json()).then(e=>{e.success?(document.getElementById("repo-name").textContent=e.data.name,document.getElementById("repo-description").textContent=e.data.description,document.getElementById("repo-author").textContent=e.data.author,document.getElementById("repo-version").textContent=e.data.version,document.getElementById("repo-updated").textContent=e.data.updated_at,document.getElementById("repo-license").textContent=e.data.license,document.getElementById("install_owner").value=t,document.getElementById("install_name").value=n,document.getElementById("install_download_url").value="",document.getElementById("repo-notes").innerHTML=e.data.release_notes,document.getElementById("nanato-github-repo-details").style.display="block"):alert(nanato_github_updates.search_error+e.data)}).catch(e=>{console.error("Fetch Error:",e),alert(nanato_github_updates.search_error+"Server error occurred. Check your server logs.")}).finally(()=>{a.disabled=!1,a.textContent=o})});const r=document.getElementById("install_type");r&&r.addEventListener("change",function(){document.querySelectorAll(".type-options").forEach(e=>e.style.display="none");const e=this.value;"theme"===e?document.getElementById("theme-options").style.display="block":"plugin"===e&&(document.getElementById("plugin-options").style.display="block")});const s=document.getElementById("nanato-github-install-form");s&&s.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("install_owner").value,n=document.getElementById("install_name").value,a=document.getElementById("install_type").value,o=document.getElementById("install_download_url").value,r=document.getElementById("add_to_updater").checked;let s=!1,d="";if("theme"===a?(d=document.getElementById("theme_slug").value,s=document.getElementById("activate_theme").checked):"plugin"===a&&(s=document.getElementById("activate_plugin").checked),!a||!t||!n)return void alert("Missing required installation parameters.");const c=this.querySelector('button[type="submit"]'),l=document.getElementById("install-status"),i=c.textContent;c.disabled=!0,c.textContent=nanato_github_updates.installing,l.innerHTML='<span class="installing">'+nanato_github_updates.installing+"</span>";const u=new FormData;u.append("action","nanato_github_install_from_github"),u.append("nonce",nanato_github_updates.nonce),u.append("type",a),u.append("owner",t),u.append("name",n),u.append("download_url",o),u.append("add_to_updater",r),"theme"===a?(u.append("slug",d),u.append("activate",s)):"plugin"===a&&u.append("activate",s),fetch(nanato_github_updates.ajax_url,{method:"POST",body:u}).then(e=>e.json()).then(e=>{if(e.success){let t="";t="object"==typeof e.data&&e.data.message?e.data.message:"string"==typeof e.data?e.data:nanato_github_updates.install_success,l.innerHTML='<span class="success">'+t+"</span>",r&&setTimeout(function(){location.reload()},2e3)}else l.innerHTML='<span class="error">'+nanato_github_updates.install_error+e.data+"</span>"}).catch(e=>{console.error("Fetch Error:",e),l.innerHTML='<span class="error">'+nanato_github_updates.install_error+"Server error occurred. Check your server logs and browser console for details.</span>"}).finally(()=>{c.disabled=!1,c.textContent=i})}),function(){if(n){const e=new Event("change");n.dispatchEvent(e)}if(r){const e=new Event("change");r.dispatchEvent(e)}}()});